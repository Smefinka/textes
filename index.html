<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Форма и предпросмотр</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    .container { display: flex; height: 100vh; }
    .form-panel, .preview-panel { padding: 20px; width: 50%; overflow-y: auto; }
    .form-panel { background: #f9f9f9; border-right: 1px solid #ddd; }
    .preview-panel { background: #fff; position: relative; }
    .field { margin-bottom: 15px; }
    .field label { display: block; margin-bottom: 5px; font-weight: bold; }
    .field input[type="text"],
    .field textarea { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
    h2 { margin-top: 0; border-bottom: 2px solid #333; padding-bottom: 5px; }
    .form-section { margin-bottom: 30px; padding-bottom: 10px; border-bottom: 1px dashed #aaa; }
    .preview-section { margin-bottom: 40px; }
    .preview-item { margin-bottom: 10px; }
    .preview-item h3 { margin: 0 0 5px; font-size: 16px; color: #555; }
    .preview-item p { margin: 0; white-space: pre-wrap; }
    .btn { padding: 8px 16px; font-size: 14px; cursor: pointer; border: none; border-radius: 4px; }
    #addBtn { background: #007BFF; color: #fff; margin-bottom: 20px; }
    #addBtn:active { background: #0069D9; }
    .copy-btn { background: #28A745; color: #fff; margin-top: 10px; }
    .copy-btn:active { background: #218838; }
  </style>
</head>
<body>
  <div class="container">
    <div class="form-panel">
      <button id="addBtn" class="btn">Добавить ТЗ</button>
      <div id="formSections"></div>
    </div>
    <div class="preview-panel">
      <h2>Предпросмотр</h2>
      <div id="previewSections"></div>
    </div>
  </div>
  <script>
    const labels = {
      title: 'Название статьи',
      length: 'Размер знаков статьи',
      purpose: 'Цель текста',
      required: 'Обязательные ключевые фразы',
      additional: 'Дополнительные ключевые фразы',
      competitors: 'Примеры конкурентов',
      structure: 'Примерная структура текста'
    };
    const fieldDefs = [
      {id: 'title', type: 'text', placeholder: 'Введите название статьи'},
      {id: 'length', type: 'text', placeholder: 'Например: 5000-6000'},
      {id: 'purpose', type: 'textarea', placeholder: 'Опишите цель текста'},
      {id: 'required', type: 'textarea', placeholder: 'Фразы через запятую'},
      {id: 'additional', type: 'textarea', placeholder: 'Фразы через запятую'},
      {id: 'competitors', type: 'textarea', placeholder: 'Ссылки или названия через запятую'},
      {id: 'structure', type: 'textarea', placeholder: 'Пункты через перевод строки'}
    ];

    let sectionCount = 0;
    const formSections = document.getElementById('formSections');
    const previewSections = document.getElementById('previewSections');

    document.getElementById('addBtn').addEventListener('click', () => {
      addSection();
    });

    function addSection() {
      const idx = sectionCount++;
      // Create form section
      const formSec = document.createElement('div');
      formSec.className = 'form-section';
      fieldDefs.forEach(def => {
        const fieldWrap = document.createElement('div'); fieldWrap.className = 'field';
        const label = document.createElement('label'); label.htmlFor = def.id + '-' + idx;
        label.textContent = labels[def.id] + ':';
        fieldWrap.appendChild(label);
        let input;
        if (def.type === 'textarea') input = document.createElement('textarea');
        else input = document.createElement('input');
        input.id = def.id + '-' + idx;
        if (def.type !== 'textarea') input.type = def.type;
        input.placeholder = def.placeholder;
        if (def.type === 'textarea') input.rows =  def.id==='structure'?4:3;
        fieldWrap.appendChild(input);
        formSec.appendChild(fieldWrap);
      });
      formSections.appendChild(formSec);

      // Create preview section
      const prevSec = document.createElement('div');
      prevSec.className = 'preview-section';
      const header = document.createElement('h3'); header.textContent = `ТЗ #${idx+1}`;
      prevSec.appendChild(header);
      fieldDefs.forEach(def => {
        const item = document.createElement('div'); item.className = 'preview-item';
        const h3 = document.createElement('h3'); h3.textContent = labels[def.id] + ':';
        const p = document.createElement('p'); p.id = 'preview-' + def.id + '-' + idx;
        item.appendChild(h3); item.appendChild(p);
        prevSec.appendChild(item);
      });
      const copyBtn = document.createElement('button');
      copyBtn.className = 'btn copy-btn';
      copyBtn.textContent = 'Скопировать ТЗ';
      copyBtn.addEventListener('click', () => copySection(idx));
      prevSec.appendChild(copyBtn);
      previewSections.appendChild(prevSec);

      // Attach input listeners
      fieldDefs.forEach(def => {
        const inp = document.getElementById(def.id + '-' + idx);
        inp.addEventListener('input', () => updatePreview(def.id, idx));
      });
    }

    function updatePreview(id, idx) {
      const inp = document.getElementById(id + '-' + idx);
      let value = inp.value.trim();
      if (id === 'length' && value) {
        value = value.replace(/\s*ЗБП$/u, '').trim() + ' ЗБП';
      }
      const p = document.getElementById('preview-' + id + '-' + idx);
      p.innerHTML = value ? value.replace(/\n/g, '<br>') : '<span style="color:#999">(не заполнено)</span>';
    }

    function copySection(idx) {
      const lines = fieldDefs.map(def => {
        const p = document.getElementById('preview-' + def.id + '-' + idx);
        return `${labels[def.id]}: ${p.innerText.trim()}`;
      });
      navigator.clipboard.writeText(lines.join('\n')).then(() => {
        alert(`ТЗ #${idx+1} скопировано в буфер обмена`);
      });
    }

    // Initialize first section
    addSection();
  </script>
</body>
</html>
